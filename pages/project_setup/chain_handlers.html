<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Chain Handlers | jagql</title>
    <meta name="description" content="A resource driven NodeJS framework to set up a {json:api} + GraphQL endpoint in record time.">
    
    
    <link rel="preload" href="/docs/assets/css/0.styles.36bac4b5.css" as="style"><link rel="preload" href="/docs/assets/js/app.33f40098.js" as="script"><link rel="preload" href="/docs/assets/js/14.1d5035c4.js" as="script"><link rel="prefetch" href="/docs/assets/js/7.d4babf6a.js"><link rel="prefetch" href="/docs/assets/js/2.234811cb.js"><link rel="prefetch" href="/docs/assets/js/3.411e8ccb.js"><link rel="prefetch" href="/docs/assets/js/4.0a4bda91.js"><link rel="prefetch" href="/docs/assets/js/5.e036f854.js"><link rel="prefetch" href="/docs/assets/js/6.ed731565.js"><link rel="prefetch" href="/docs/assets/js/8.ea440736.js"><link rel="prefetch" href="/docs/assets/js/9.74a9c92a.js"><link rel="prefetch" href="/docs/assets/js/10.669f7a14.js"><link rel="prefetch" href="/docs/assets/js/11.0a9685d2.js"><link rel="prefetch" href="/docs/assets/js/12.57331711.js"><link rel="prefetch" href="/docs/assets/js/13.04813cb7.js"><link rel="prefetch" href="/docs/assets/js/15.4e8e3905.js"><link rel="prefetch" href="/docs/assets/js/16.e21d6992.js"><link rel="prefetch" href="/docs/assets/js/17.3a05acca.js"><link rel="prefetch" href="/docs/assets/js/18.69c1a0d6.js"><link rel="prefetch" href="/docs/assets/js/19.d9ea053b.js">
    <link rel="stylesheet" href="/docs/assets/css/0.styles.36bac4b5.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/docs/" class="home-link router-link-active"><!----> <span class="site-name">jagql</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/docs/pages/" class="nav-link router-link-active">Guide</a></div> <a href="https://github.com/jagql/framework" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/docs/pages/" class="nav-link router-link-active">Guide</a></div> <a href="https://github.com/jagql/framework" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/docs/pages/" class="sidebar-link">Introduction</a></li><li><a href="/docs/pages/getting-started.html" class="sidebar-link">Getting Started</a></li><li><a href="/docs/pages/configuration.html" class="sidebar-link">Configuration</a></li><li><div class="sidebar-group"><p class="sidebar-heading open"><span>Project Setup</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/docs/pages/project_setup/resources.html" class="sidebar-link">Resources</a></li><li><a href="/docs/pages/project_setup/relationships.html" class="sidebar-link">Relationships</a></li><li><a href="/docs/pages/project_setup/handlers.html" class="sidebar-link">Handlers</a></li><li><a href="/docs/pages/project_setup/chain_handlers.html" class="active sidebar-link">Chain Handlers</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/docs/pages/project_setup/query_filter.html" class="sidebar-link">Query and Filter</a></li><li><a href="/docs/pages/project_setup/suggested_structure.html" class="sidebar-link">Suggested Structure</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>API Generation</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/docs/pages/apidocs/swagger.html" class="sidebar-link">Swagger</a></li><li><a href="/docs/pages/apidocs/graphql.html" class="sidebar-link">GraphQL</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Debugging</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/docs/pages/debugging/metrics.html" class="sidebar-link">Metrics</a></li><li><a href="/docs/pages/debugging/logging.html" class="sidebar-link">Application Logs</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Further Reading</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/docs/pages/further_reading/migrate_from_express.html" class="sidebar-link">Migrate from Express</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="chain-handlers"><a href="#chain-handlers" aria-hidden="true" class="header-anchor">#</a> Chain Handlers</h1> <h3 id="chaining-handlers-together-with-the-chainhandler"><a href="#chaining-handlers-together-with-the-chainhandler" aria-hidden="true" class="header-anchor">#</a> Chaining handlers together with the ChainHandler</h3> <p>This project ships with a handler called the <code>ChainHandler</code>. It's purpose is to make it easier to wrap the functionality of one handler with additional functionality. For example using the relational data store may be ideal for storing resources, but what if we want to add an authentication layer on top of those resources? An authentication handler shouldn't know or care about the storage of the underlying resource, it should only deal with authentication - we need an abstraction layer to help us glue all of this together.</p> <p>To get started with the ChainHandler, go ahead and instantiate one:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> jagql <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;@jagql/framework&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> testChainHandler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">jagql<span class="token punctuation">.</span>ChainHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>From there it's a simple case of attaching new function handlers to <code>testChainHandler</code>, following the naming convention of <code>(&quot;before&quot;|&quot;after&quot;)+function</code> - eg <code>beforeSearch</code>, <code>beforeCreate</code>, <code>afterDelete</code>.</p> <p>These new functions need to match the signatures of the functions they're overriding and need to pass the data onwards via a callback. For example, here are two valid functions that don't add any functionality. Notice how the callback values match the function signatures:</p> <div class="language- extra-class"><pre class="language-text"><code>testChainHandler.beforeSearch = function(request, callback) {
  return callback(null, request);
};

testChainHandler.afterSearch = function(request, results, pagination, callback) {
  return callback(null, results, pagination);
};
</code></pre></div><p><em>NOTE</em> The only exception to the above is that all <code>after</code> function signatures are also passed the original <code>request</code> object in addition to the other objects. This enables us to implement clever features on a per-request basis by providing a mechanism to push state between <code>before</code> and <code>after</code> functions.</p> <p>With a new ChainHandler ready to go, this is how we can stack them up:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>jagql<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  resource<span class="token punctuation">:</span> <span class="token string">&quot;articles&quot;</span><span class="token punctuation">,</span>
  handlers<span class="token punctuation">:</span> chainHandler1<span class="token punctuation">.</span><span class="token function">chain</span><span class="token punctuation">(</span>chainHandler2<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">chain</span><span class="token punctuation">(</span>memoryHandler<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>The call stack when chaining multiple <code>ChainHandler</code>s together looks like this:</p> <div class="language- extra-class"><pre class="language-text"><code>chainHandler1.beforeSearch
  chainHandler2.beforeSearch
    MemoryHandler.search
  chainHandler2.afterSearch
chainHandler1.afterSearch
</code></pre></div></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/jagql/docs/edit/master/pages/project_setup/chain_handlers.md" target="_blank" rel="noopener noreferrer">Improve this documentation</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/docs/pages/project_setup/handlers.html" class="prev">
          Handlers
        </a></span> <span class="next"><a href="/docs/pages/project_setup/query_filter.html">
          Query and Filter
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/docs/assets/js/14.1d5035c4.js" defer></script><script src="/docs/assets/js/app.33f40098.js" defer></script>
  </body>
</html>
